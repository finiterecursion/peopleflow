{% extends "kiosks_layout.html" %}
{% block title %}Sponsors Kiosk -  {{ kiosk.name }} {% endblock %}

{% block basecontent %}

<div id="info" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="info-label" aria-hidden="true">
  <div class="modal-header">
    <h3 id="info-label">Confirmation</h3>
  </div>
  <div class="modal-body">
    <div>
      <h2>Hi <strong><span class="name"></span></strong>!</h2>
      <h3>Your contact details will be shared with {{ kiosk.name }}.</h3>
    </div>
  </div>
  <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Cancel</button>
    <button class="btn" data-dismiss="modal" aria-hidden="true">I'm not <span class="name"></span></button>
    <form id="kiosk" action="{{ url_for('share', kiosk=kiosk.name) }}" method="POST">
      <input id="nfc_id" class="hidden" type="hidden" name="id" value="" />
      <input id="share" class="btn btn-primary hidden" type="submit" value="Share" />
      <input type="submit" class="btn btn-primary" value="Share">
    </form>
  </div>
</div>
<div id="error"> </div>
<div id="card"><h2>Tap your card to share contact information</h2></div>

{% endblock %}
{% block footerscripts %}
{{ super() }}
<script type="text/javascript">
rfid['tag_placed'] = function(data) {
  this.action('tag_placed', data);
  if (data['tag_id']) {
    url = "/participant/"+data['tag_id'];
    $('input#nfc_id').attr("value",data['tag_id'] );
    // $('input#share').removeClass("hidden")

    $.getJSON(url, function(data){
      if(data["error"]){
        $('div#info, input#share').addClass("hidden");
        $('div#error').removeClass("hidden").html('<h2>Invalid Card</h2>');
      }
      else{
        $('div#error').addClass("hidden");
        $('div#info').removeClass("hidden");
        $('div#name').html('<h1>'+data['name']+'</h1>');
        $('div#email').html('<h2>'+data['email']+'</h2>');
        $('#info .name').html(data.name);
        $('#info').modal();
      };
    });
  }
};

</script>

{% endblock %}